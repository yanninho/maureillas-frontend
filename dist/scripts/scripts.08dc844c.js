"use strict";angular.module("maureillasApp").config(["$routeProvider","$locationProvider","$translateProvider","$translatePartialLoaderProvider","VIEWS",function(a,b,c,d,e){angular.forEach(e,function(b,c){angular.forEach(b.pages,function(b,d){a.when(b.path,{templateUrl:"modules/"+c+"/views/"+b.templateHtml,controller:b.controller})})}),a.otherwise({}),d.addPart("main"),c.useLoader("$translatePartialLoader",{urlTemplate:"modules/{part}/i18n/{lang}.json"}),c.preferredLanguage("fr")}]),angular.module("maureillasApp.common",[]),angular.module("maureillasApp.common").factory("RestService",["$q","$http","TechnicalExceptionService",function(a,b,c){var d=a.when("start"),e=function(a,b,c,d){return a},f=function(b,c,d,e){return console.log("http error : "+c),a.reject()},g=function(a){var b=", attendu : config { url, method } voir https://docs.angularjs.org/api/ng/service/$http";angular.isUndefined(a)&&c["new"]("objet config pour un appel Rest : [undefined]"+b),angular.isUndefined(a.url)&&c["new"]("url dans config pour un appel Rest : [undefined]"+b),angular.isUndefined(a.method)&&c["new"]("method dans config pour un appel Rest : [undefined]"+b)};return{call:function(a){g(a);var c=d.then(function(){return b(a).success(e).error(f)});return c}}}]),angular.module("maureillasApp.common").factory("TechnicalExceptionService",function(){return{"new":function(a){function b(a){this.name="TechnicalException",this.message=a}throw b.prototype=new Error,b.prototype.constructor=b,new b(a)}}}),angular.module("maureillasApp.common").factory("$exceptionHandler",function(){return function(a,b){alert(a.message),console.log(a.message)}}),angular.module("maureillasApp.common").constant("VIEWS",{feeds:{definition:{path:"feeds"},pages:{agenda:{label:"navigation.AGENDA",path:"/feeds",templateHtml:"feeds.html",controller:"FeedsCtrl"},annonces:{label:"navigation.ANNONCES",path:"/feeds",templateHtml:"feeds.html",controller:"FeedsCtrl"}}}}).constant("FEEDS",{agenda:{url:"http://maureillas.surikwat.com/evenements/feed/"},annonces:{url:"http://maureillas.surikwat.com/category/annonces/feed/"}}).constant("REMOTE",{googleFeedsService:{url:"http://ajax.googleapis.com/ajax/services/feed/load",method:"JSONP",params:{v:"1.0",callback:"JSON_CALLBACK"}},pushService:{GCM:{key:"904172923113"}},maureillasService:{users:{createUser:{url:"/v1/users/{ID}/{PLATFORM}",method:"PUT"},deleteUser:{url:"/v1/users/{ID}",method:"DELETE"},getUser:{url:"/v1/users/{ID}",method:"GET"},updateUser:{url:"/v1/users/{ID}",method:"POST"}}}}).constant("URLS",{urlBackend:"http://key:dvZ3UA6BqgUsLrP82Kj5bDCu6jcsDZ35@maureillas.herokuapp.com"}),angular.module("maureillasApp.feeds",["maureillasApp.common"]).config(["$translatePartialLoaderProvider","VIEWS",function(a,b){a.addPart(b.feeds.definition.path)}]),angular.module("maureillasApp.feeds").factory("FeedListService",["RestService","REMOTE",function(a,b){var c={feeds:{}},d=function(a){console.log(a),c.feeds=a.data.responseData.feed},e=function(c,e){var f=b.googleFeedsService;f.params.q=c,f.params.num=e;var g=a.call(f);g.then(d)};return{get:c,fetchFeeds:function(a,b){e(a,b)}}}]),angular.module("maureillasApp.feeds").controller("FeedsCtrl",["$scope","$location","FeedListService","FEEDS",function(a,b,c,d){a.feedList=c.get;var e=b.search();if(!angular.isUndefined(e.feed)){var f=e.feed;c.fetchFeeds(d[f].url,10)}}]),angular.module("maureillasApp.push",["maureillasApp.common","maureillasApp.server"]).config(["$translatePartialLoaderProvider",function(a){a.addPart("push")}]),angular.module("maureillasApp.feeds").factory("PushService",["$q","$window","REMOTE",function(a,b,c){var d={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return d.Android()||d.BlackBerry()||d.iOS()||d.Opera()||d.Windows()}},e={deviceregisterId:void 0},f={};return d.any()&&(f="android"==device.platform||"Android"==device.platform?{senderID:c.pushService.GCM.key,ecb:"onNotificationGCM"}:{badge:"true",sound:"true",alert:"true",ecb:"onNotificationAPN"}),b.onNotificationGCM=function(a){switch(a.event){case"registered":a.regid.length>0&&(console.log("regID = "+a.regid),alert("regID = "+a.regid),e.deviceregisterId=a.regid);break;case"message":if(a.foreground){console.log("INLINE NOTIFICATION");var b=new Media("/android_asset/www/"+a.soundname);b.play()}else console.log(a.coldstart?"COLDSTART NOTIFICATION":"BACKGROUND NOTIFICATION");navigator.notification.alert(a.payload.message),console.log("MESSAGE -> MSG: "+a.payload.message),console.log("MESSAGE -> MSGCNT: "+a.payload.msgcnt),console.log("MESSAGE -> TIME: "+a.payload.timeStamp);break;case"error":console.log("ERROR -> MSG:"+a.msg);break;default:console.log("EVENT -> Unknown, an event was received and we do not know what it is")}},b.successIosHandler=function(a){console.log("result = "+a)},b.onNotificationAPN=function(a){if(a.alert&&(console.log("push-notification: "+a.alert),navigator.notification.alert(a.alert)),a.sound){var b=new Media(a.sound);b.play()}a.badge&&pushNotification.setApplicationIconBadgeNumber("successIosHandler",a.badge)},{register:function(){var b=a.defer();return d.any()?window.plugins.pushNotification.register(function(a){b.resolve(a)},function(a){b.reject(a)},f):b.reject("not on mobile device"),b.promise},getData:function(){return e}}}]),angular.module("maureillasApp.feeds").controller("PushCtrl",["$scope","PushService","UserService",function(a,b,c){angular.isUndefined(b.getData().deviceregisterId)&&b.register().then(function(a){var d=b.getData().deviceregisterId;console.log(a),console.log("ID: "+d),alert("ID: "+d),angular.isDefined(d)&&c.register(d)},function(a){console.log(a)})}]),angular.module("maureillasApp.server",["maureillasApp.common"]),angular.module("maureillasApp.server").factory("UserService",["RestService","URLS","REMOTE","PlatformService",function(a,b,c,d){var e=function(b){var e=c.maureillasService.users.createUser;e.url=e.url.replace("{ID}",b),e.url=e.url.replace("{PLATFORM}",d.getPlatform());a.call(e)},f=function(b){var d=c.maureillasService.users.deleteUser;d.url=d.url.replace("{ID}",b);a.call(d)},g=function(b){var d=c.maureillasService.users.getUser;d.url=d.url.replace("{ID}",b);a.call(d)},h=function(b,d){var e=c.maureillasService.users.updateUser;e.url=e.url.replace("{ID}",b),e.params=d;a.call(e)};return{register:function(a){return e(a)},unregister:function(a){return f(a)},get:function(a){return g(a)},update:function(a,b){return h(a,b)}}}]),angular.module("maureillasApp.server").factory("PlatformService",function(){var a=function(){var a="";return a="android"==device.platform||"Android"==device.platform?"GOOGLE":"IOS"};return{getPlatform:function(){return a()}}});